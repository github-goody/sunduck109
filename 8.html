<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì„ ë•ê³ ë“±í•™êµ 1í•™ë…„ 9ë°˜ í•™ê¸‰ ê±´ì˜í•¨</title>
<style>
  /* ëª¨ë‹¬ ë°°ê²½ */
  #modalOverlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  /* ëª¨ë‹¬ ë°•ìŠ¤ */
  #modalBox {
    background-color: white;
    padding: 20px 30px;
    border-radius: 8px;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  }
  button { margin-top: 20px; padding: 8px 20px; font-size: 14px; cursor: pointer; }
  body {
    font-family: "Nanum Gothic", "Malgun Gothic", "Apple SD Gothic Neo", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background-color: #fff; color: #000; padding: 40px 20px 60px;
    max-width: 600px; margin: auto;
  }
  #mainTitle { font-weight: 900; font-size: 36px; text-align: center; margin-bottom: 4px; }
  #subTitle { font-family: "Georgia", "Times New Roman", serif; font-style: italic; font-size: 16px;
    color: #555; text-align: center; margin-bottom: 30px; user-select: none;
  }
  form { display: flex; gap: 10px; margin-bottom: 20px; font-size: 12px; }
  input[type="text"], input[type="password"] { padding: 5px; border: 1px solid #ddd; font-size: 12px; font-family: inherit; }
  input[name="name"], input[name="password"] { width: 80px; }
  input[name="message"] { flex: 1; }
  button[type="submit"] { padding: 5px 15px; font-size: 12px; background-color: #efefef; border: 1px solid #ccc; }
  button[type="submit"]:hover { background-color: #e0e0e0; }
  ul { list-style-type: none; padding: 0; }
  li { font-size: 12px; border-bottom: 1px solid #ddd; padding: 8px 0; display: flex; justify-content: space-between; align-items: center; }
  .entry-left { flex-grow: 1; }
  .entry-time { color: #888; font-size: 11px; white-space: nowrap; margin-left: 10px; }
  .delete-btn { margin-left: 10px; font-size: 11px; cursor: pointer; }
</style>
</head>
<body>

<!-- ê°œì¸ì •ë³´ë³´í˜¸ë²• ê²½ê³  ëª¨ë‹¬ -->
<div id="modalOverlay">
  <div id="modalBox">
    <h2>ê°œì¸ì •ë³´ë³´í˜¸ë²• ìœ„ë°˜ ì£¼ì˜</h2>
    <p>ê°œì¸ì •ë³´ë¥¼ ë¬´ë‹¨ìœ¼ë¡œ ê²Œì‹œí•  ê²½ìš° ë²•ì  ì²˜ë²Œì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>ì‘ì„± ì‹œ ì£¼ì˜í•´ ì£¼ì„¸ìš”.</p>
    <button id="closeBtn">í™•ì¸</button>
  </div>
</div>

<!-- ì œëª© -->
<div id="mainTitle">ì„ ë•ê³ ë“±í•™êµ 1í•™ë…„ 9ë°˜ í•™ê¸‰ ê±´ì˜í•¨</div>
<div id="subTitle">SunDuck 1-9</div>

<!-- ë°©ëª…ë¡ ì‘ì„± í¼ -->
<form id="guestbook-form">
  <input type="text" name="name" placeholder="ì´ë¦„" required />
  <input type="text" name="message" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required />
  <input type="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required />
  <button type="submit">ì‘ì„±</button>
</form>

<!-- ë°©ëª…ë¡ ë¦¬ìŠ¤íŠ¸ -->
<ul id="guestbook-entries"></ul>

<script type="module">
  // ğŸ”¹ Firebase SDK ì—°ê²°
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAUzxNTpRe0V1ELKQfNgIwdlC2rnHxk9ts",
    authDomain: "sunduck109.firebaseapp.com",
    databaseURL: "https://sunduck109-default-rtdb.firebaseio.com",
    projectId: "sunduck109",
    storageBucket: "sunduck109.firebasestorage.app",
    messagingSenderId: "442985649228",
    appId: "1:442985649228:web:5c91090247fb2fa6c090e9",
    measurementId: "G-G60DXGGLDT"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const modal = document.getElementById('modalOverlay');
  const closeBtn = document.getElementById('closeBtn');
  const form = document.getElementById("guestbook-form");
  const entriesList = document.getElementById("guestbook-entries");

  closeBtn.addEventListener('click', () => { modal.style.display = 'none'; });

  function createEntryElement(key, entry) {
    const li = document.createElement("li");
    li.innerHTML = `
      <div class="entry-left">
        <span class="entry-name">${entry.name}</span>
        ${entry.message}
        <div class="entry-time">${entry.time}</div>
      </div>
      <button class="delete-btn">ì‚­ì œ</button>
    `;

    li.querySelector(".delete-btn").addEventListener("click", () => {
      const inputPwd = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
      if(inputPwd === null) return;
      if(inputPwd === entry.password) {
        remove(ref(db, 'guestbook/' + key));
      } else {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
      }
    });

    return li;
  }

  function renderEntries(data) {
    entriesList.innerHTML = "";
    for(const [key, value] of Object.entries(data || {})) {
      entriesList.appendChild(createEntryElement(key, value));
    }
  }

  // ì‹¤ì‹œê°„ìœ¼ë¡œ DB ë³€í™”ë¥¼ ë°˜ì˜
  const guestbookRef = ref(db, 'guestbook');
  onValue(guestbookRef, (snapshot) => {
    renderEntries(snapshot.val());
  });

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const name = form.name.value.trim();
    const message = form.message.value.trim();
    const password = form.password.value;
    const time = new Date().toLocaleString();
    if(!name || !message || !password) { alert("ëª¨ë“  ì…ë ¥ë€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”."); return; }

    push(guestbookRef, { name, message, password, time });

    form.name.value = "";
    form.message.value = "";
    form.password.value = "";
  });
</script>

</body>
</html>
