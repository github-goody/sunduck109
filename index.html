<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>선덕고등학교 1학년 9반 학급 건의함</title>
<style>
  /* 모달 배경 */
  #modalOverlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  /* 모달 박스 */
  #modalBox {
    background-color: white;
    padding: 20px 30px;
    border-radius: 8px;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  }
  button { margin-top: 20px; padding: 8px 20px; font-size: 14px; cursor: pointer; }
  body {
    font-family: "Nanum Gothic", "Malgun Gothic", "Apple SD Gothic Neo", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background-color: #fff; color: #000; padding: 40px 20px 60px;
    max-width: 600px; margin: auto;
  }
  #mainTitle { font-weight: 900; font-size: 36px; text-align: center; margin-bottom: 4px; }
  #subTitle { font-family: "Georgia", "Times New Roman", serif; font-style: italic; font-size: 16px;
    color: #555; text-align: center; margin-bottom: 30px; user-select: none;
  }
  form { display: flex; gap: 10px; margin-bottom: 20px; font-size: 12px; }
  input[type="text"], input[type="password"], input[name="inviteCode"] { padding: 5px; border: 1px solid #ddd; font-size: 12px; font-family: inherit; width: 80px; }
  input[name="message"] { flex: 1; }
  button[type="submit"] { padding: 5px 15px; font-size: 12px; background-color: #efefef; border: 1px solid #ccc; }
  button[type="submit"]:hover { background-color: #e0e0e0; }
  ul { list-style-type: none; padding: 0; }
  li { font-size: 12px; border-bottom: 1px solid #ddd; padding: 8px 0; display: flex; justify-content: space-between; align-items: center; }
  .entry-left { flex-grow: 1; }
  .entry-time { color: #888; font-size: 11px; white-space: nowrap; margin-left: 10px; }
  .entry-code { color: #555; font-size: 11px; margin-left: 10px; }
  .delete-btn { margin-left: 10px; font-size: 11px; cursor: pointer; }
</style>
</head>
<body>

<!-- 개인정보보호법 경고 모달 -->
<div id="modalOverlay">
  <div id="modalBox">
    <h2>개인정보보호법 위반 주의</h2>
    <p>개인정보를 무단으로 게시할 경우 법적 처벌을 받을 수 있습니다.<br>작성 시 주의해 주세요.</p>
    <button id="closeBtn">확인</button>
  </div>
</div>

<!-- 제목 -->
<div id="mainTitle">선덕고등학교 1학년 9반 학급 건의함</div>
<div id="subTitle">SunDuck 1-9</div>

<!-- 초대 코드 입력 섹션 -->
<div id="inviteSection">
  <form id="invite-form">
    <input type="text" id="inviteCode" placeholder="초대 코드 입력" required />
    <button type="submit">입장</button>
  </form>
</div>

<!-- 방명록 작성 섹션 (초대 코드 인증 후 표시) -->
<div id="mainSection" style="display:none;">
  <form id="guestbook-form">
    <input type="text" name="name" placeholder="이름" required />
    <input type="text" name="message" placeholder="내용을 입력하세요" required />
    <input type="password" name="password" placeholder="비밀번호" required />
    <button type="submit">작성</button>
  </form>
  <ul id="guestbook-entries"></ul>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAUzxNTpRe0V1ELKQfNgIwdlC2rnHxk9ts",
    authDomain: "sunduck109.firebaseapp.com",
    databaseURL: "https://sunduck109-default-rtdb.firebaseio.com",
    projectId: "sunduck109",
    storageBucket: "sunduck109.firebasestorage.app",
    messagingSenderId: "442985649228",
    appId: "1:442985649228:web:5c91090247fb2fa6c090e9",
    measurementId: "G-G60DXGGLDT"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const modal = document.getElementById('modalOverlay');
  const closeBtn = document.getElementById('closeBtn');
  const inviteForm = document.getElementById("invite-form");
  const guestForm = document.getElementById("guestbook-form");
  const entriesList = document.getElementById("guestbook-entries");

  const inviteSection = document.getElementById("inviteSection");
  const mainSection = document.getElementById("mainSection");

  const inviteCodes = ["XQJ582","ABM193","LPO746","RZT021","GKH657","VFD384","QWE905","NMK472",
                       "TYU836","JHG591","BVC273","PLM640","SDF729","KJH184","ZXN307","ERT926",
                       "UIO583","QAZ471","WSX690","EDC354","RFV217","TGB865","YHN039","UJM642",
                       "IKL751","OPQ208","ASD376","FGH904","JKL532","QWE138","RTY469","ZXC805"];

  let currentCode = ""; // 사용한 초대코드 저장

  closeBtn.addEventListener('click', () => { modal.style.display = 'none'; });

  // 초대 코드 확인
  inviteForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const code = document.getElementById("inviteCode").value.trim();
      if(inviteCodes.includes(code)) {
          currentCode = code;           // 현재 코드 저장
          localStorage.setItem("verified","true");
          inviteSection.style.display = "none";
          mainSection.style.display = "block";
      } else {
          alert("초대 코드가 올바르지 않습니다.");
      }
  });

  // 이미 인증한 사용자면 바로 보여주기
  if(localStorage.getItem("verified") === "true"){
      inviteSection.style.display = "none";
      mainSection.style.display = "block";
  }

  function createEntryElement(key, entry) {
    const li = document.createElement("li");
    li.innerHTML = `
      <div class="entry-left">
        <span class="entry-name">${entry.name}</span>
        ${entry.message}
        <div class="entry-time">${entry.time}</div>
        <div class="entry-code">[코드: ${entry.inviteCode}]</div>
      </div>
      <button class="delete-btn">삭제</button>
    `;
    li.querySelector(".delete-btn").addEventListener("click", () => {
      const inputPwd = prompt("비밀번호를 입력하세요:");
      if(inputPwd === null) return;
      if(inputPwd === entry.password) {
        remove(ref(db, 'guestbook/' + key));
      } else {
        alert("비밀번호가 틀렸습니다.");
      }
    });
    return li;
  }

  function renderEntries(data) {
    entriesList.innerHTML = "";
    for(const [key, value] of Object.entries(data || {})) {
      entriesList.appendChild(createEntryElement(key, value));
    }
  }

  // 실시간 DB 반영
  const guestbookRef = ref(db, 'guestbook');
  onValue(guestbookRef, (snapshot) => {
    renderEntries(snapshot.val());
  });

  // 글 작성
  guestForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = guestForm.name.value.trim();
      const message = guestForm.message.value.trim();
      const password = guestForm.password.value;
      const time = new Date().toLocaleString();
      if(!name || !message || !password) { alert("모든 입력란을 작성해주세요."); return; }
      push(guestbookRef, { 
          name, 
          message, 
          password, 
          time,
          inviteCode: currentCode // 사용한 초대코드 저장
      });
      guestForm.name.value = "";
      guestForm.message.value = "";
      guestForm.password.value = "";
  });

</script>

</body>
</html>


</body>
</html>



